<html>
<head>
    <title>HMI Annotation</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <style>
        body {
        font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande",
        sans-serif;
        font-weight: 300;
        letter-spacing: .05rem;
        }
        textarea {
        font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande",
        sans-serif;
        font-size: 14px;
        line-height: 21px;
        }
        .paragraph {
        padding: 10px 0 20px 0;
        }
        .sentence {
        border-top: 1px solid #ddd;
        padding: 10px 0 20px 0;
        }
        .phrase {
        /*border-bottom: 1px dashed #eee;*/
        padding: 5px 0 5px 0;
        }
        .word {
        margin: 8px 0 8px 0;
        padding: 2px 1px 2px 3px;
        background-color: #fff;
        cursor: pointer;
        }
        .word.entity {
        background-color:#eef;
        }
        .word:hover {
        background-color:#ffc;
        }

        #ui2 { display : none; }
        #info { display: none; background-color: #777; position: fixed; padding: 10px; color: #fff; font-size: 17px; }
    </style>
</head>
<body>
<div id="ui1">
    <textarea rows="6" cols="80" id="txt">Like all men of the Library, I have traveled in my youth; I have wandered in search of a book, perhaps the catalogue of catalogues; now that my eyes can hardly decipher what I write, I am preparing to die just a few leagues from the hexagon in which I was born. Once I am dead, there will be no lack of pious hands to throw me over the railing; my grave will be the fathomless air; my body will sink endlessly and decay and dissolve in the wind generated by the fall, which is infinite. I say that the Library is unending. The idealists argue that the hexagonal rooms are a necessary form of absolute space or, at least, of our intuition of space. They reason that a triangular or pentagonal room is inconceivable. (The mystics claim that their ecstasy reveals to them a circular chamber containing a great circular book, whose spine is continuous and which follows the complete circle of the walls; but their testimony is suspect; their words, obscure. This cyclical book is God.) Let it suffice now for me to repeat the classic dictum: The Library is a sphere whose exact center is any one of its hexagons and whose circumference is inaccessible.

There are five shelves for each of the hexagon's walls; each shelf contains thirty-five books of uniform format; each book is of four hundred and ten pages; each page, of forty lines, each line, of some eighty letters which are black in color. There are also letters on the spine of each book; these letters do not indicate or prefigure what the pages will say. I know that this incoherence at one time seemed mysterious. Before summarizing the solution (whose discovery, in spite of its tragic projections, is perhaps the capital fact in history) I wish to recall a few axioms.
    </textarea><br>
    <button id="btn">Submit</button>
</div>
<div id="ui2">
    <button id="back">Back</button>
</div>
<div id="root">

</div>
<div id="info">

</div>
</body>
<script>
var $root = $("#root");
var $info = $("#info");
var $ui1 = $("#ui1");
var $ui2 = $("#ui2");

$("#btn").click(function(){
    var ts = $("#txt").val();
    $ui1.hide();
    $.ajax({url: 'http://localhost:4567/annotate?s='+encodeURIComponent(ts), method: 'get'}).done(function(r){
        $ui2.show();
        $root.empty();
        $root.show();
        //console.log("!",JSON.parse(r));
        var p = JSON.parse(r).document;
        $(document.body).append($root);
        p.forEach(function(q){
           var $pp = $("<div></div>").addClass("paragraph");
           $root.append($pp);
           q.forEach(function(r){
                var $sent = $("<div></div>").addClass("sentence");
                $pp.append($sent);
                r.forEach(function(s){
                    var $phr = $("<div></div>").addClass("phrase");
                    $sent.append($phr);
                    s.forEach(function(t){
                        var $w = $("<a></a>").addClass("word");
                        $phr.append($w);
                        $w.text(t.text);
                        if (t.entity)
                            $w.addClass("entity");
                        $w.mouseover(function(){
                            var p = $w.offset();
                            $info.css({top: (p.top + 20)+"px", left: p.left+"px"});
                            $info.empty();
                            var tt = "";
                            if (t.entity)
                                tt = t.entity + " / ";
                            tt += t.pos;
                            tt += "<br>"
                            if (t.syllables) {
                                t.syllables.forEach(function(u){
                                    tt += u.join(" ")+ " - ";
                                });
                                tt = tt.substring(0,tt.length-2);
                            }
                            $info.html(tt);
                            $info.show();
                        });
                        $w.mouseout(function(){
                            $info.hide();
                        });
                    });
                });
            });
        });
    }).error(function(err){
        console.error(err);
    });
});
$("#back").click(function(){
    $ui1.show();
    $ui2.hide();
    $info.hide();
    $root.empty();
    $root.hide();
});

</script>
</html>